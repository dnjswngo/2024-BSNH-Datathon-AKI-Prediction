# 🏥 분당서울대병원 AKI 예측 모델 개발 (2024 SNUBH Datathon 본선)

## 소개

2024 SNUBH Datathon 본선에서 진행한 **AKI(급성신손상) 예측 모델 개발 프로젝트**입니다.

**중환자 데이터 기반 조기 예측 모델링**, **임상 도메인 해석 기반 변수 선별**,

**공정성 고려(Reweighing)** 및 **설명 가능한 AI(XAI)** 까지 포함하여

실질적인 **임상 적용 가능성**과 **AI 윤리성**을 함께 고려했습니다.

---

## 🗂 프로젝트 개요

- **프로젝트명**: 분당서울대병원 AKI 예측 모델 개발
- **진행 기간**: 2024.09 ~ 2024.10
- **성과**:
    - 예선:  69팀 중 상위 10위권 진출
    - 본선: **최종 5위 ㅜ__ㅜ**
- **역할**:
    - 의료 데이터를 기반으로 한 변수 설계 및 전처리 전담
    - 슬라이딩 윈도우 기반 시계열 구성
    - 모델 학습 및 성능 평가, 공정성 보정 수행
- **목적**:
    
    입원 환자의 Vital, Lab, 약물, 진단, 기본 정보를 바탕으로
    
    **입원 후 초기 2일간의 정보를 입력하면 이후 24시간 내 AKI 발생 여부를 예측**하는
    
    **조기경고 시스템 구축**
    

---

## 🧪 데이터 구성 및 전처리

- **데이터 출처**: SNUBH 제공 임상 로그 (2022~2023년 기준)
- **데이터 유형**:
    - Vital: SBP/DBP, PR, BT, SpO2 등 (1시간 단위 측정)
    - Lab: Creatinine, Phosphorus, Albumin 등 (1일 1~2회 측정)
    - Medication: 약물 복용 이력 및 nephrotoxicity 분류
    - Diagnosis: AKI/CKD 병력 여부 및 동반 질환
    - Patient: 성별, 나이, 직업, 결혼상태, 진료과 등 보호 변수 포함
- **전처리 및 가공 방식**:
    - 이상치 제거: 의료적으로 불가능한 수치 필터링
    - 결측값 처리:
        - Vital: 선형 보간
        - Lab: 평균값 대체
        - Height/Weight: 다중 선형 회귀로 예측
    - **슬라이딩 윈도우 구성**:
        - 초기 2일간의 데이터를 입력으로 구성 (Day 0~2, 0일차는 1일차를 복사했어요)
        - **3일차~7일차까지 발생하는 AKI 여부를 타겟으로 설정**
    - **수치 집계**:
        - Vital: 평균, 최소, 최대
        - Lab: 평균
        - 약물/진단: 범주형 인코딩 또는 그대로 유지

---

## 📊 탐색적 데이터 분석 (EDA)

- AKI 발생률: 전체 입원 환자 중 약 6~8% 수준
- 환자 특성에 따른 발생률 차이 확인 (성별, 연령대, 진료과 등)
- 보호 변수별 데이터 불균형 확인 후 공정성 전략 설계

---

## 🤖 모델링 및 평가

- **모델**: XGBoost (scale_pos_weight 및 Optuna 튜닝 적용)
- **하이퍼파라미터**:
    - `max_depth`, `learning_rate`, `gamma`, `scale_pos_weight` 등
    - **Recall 기준으로 Optuna 튜닝 진행**
- **데이터 분할**:
    - 환자 기준으로 train : valid : test = 8.1 : 0.9 : 1.0
    - 같은 환자가 여러 집합에 중복되지 않도록 그룹 분할
- **성능 결과 (본선 기준 Test Set)**:
    - **Recall**: 0.7081
    - **Precision**: 0.3636
    - **F1 Score**: 0.4800
    - **AUC**: 0.7770
- **SHAP 기반 중요 변수**:
    - Creatinine_t1 / t2
    - SBP_min_t2
    - Phosphorus_t2
    - 기저 eGFR, 약물 등

---

## ⚖️ 공정성 처리 (Fairness Handling)

- **보호 변수**:
    - 성별, 연령대, 직업, 종교, 결혼 상태, 입원 부서
- **Reweighing 방식 적용**:
    - 특권/비특권 그룹을 구분 후, **가중치 조정**
    - AIF360 라이브러리 기반 처리
- **공정성 평가 지표**:
    - **Equal Opportunity Difference (EOD)**
    - **Disparate Impact (DI)**
- **개선 효과**:
    - 일부 보호 변수 기준 성능 편차 감소 확인
    - 진료과별 데이터 수 불균형 해결을 위해 **의학적 기준 기반 그룹화 수행**

---

## 🧠 XAI 적용 (모델 설명력 강화)

- **SHAP 값 시각화**:
    
    전역 feature 영향도 확인 → AKI 예측에 주요한 Lab 지표 도출
    
- **LIME**:
    
    개별 환자에 대한 예측 사유 설명 제공 → 임상에서 활용 가능한 예측 근거 제시
    

---

## ✅ 결론 및 기대효과

- **슬라이딩 윈도우 기반 조기 예측**: 입원 초기 상태만으로도 향후 위험 예측 가능
- **설명 가능한 AI + 공정성 보정**: 실질 임상 도입을 고려한 모델 설계
- **맞춤형 의료 확장 가능성**: 환자군별 모델 적용 또는 리스크 기반 의사결정 지원 시스템 구축 가능


---

## 📝 아쉬운 점

- **Creatinine 결측 문제**: Creatinine은 AKI 진단 기준의 핵심 지표임에도 불구하고,
결측 비율이 매우 높아 보간하거나 활용 가능한 환자 수가 제한적
- **공정성 지표의 한계**: EOD/DI 외에도 의료 특화된 윤리 지표 필요, 좀 더 정밀한 기준이 필요할 듯
- **시계열 모델 다양성 부족**: 더 다양한 시계열 모델을 사용해보고 싶었으나, 데이터 분석에 너무 많은 시간을 썼음
- **주체측의 기준 미흡**: 은 조금 심했다. 아무리 자유도가 높은 대회라해도, 질문을 해야지만 그 이슈에 대한 기준이 생겼고, 대회 진행 중에 추가로 규칙들이 생겨서 여러 번 뒤집어 엎었음.. 슬랙에서 주고 받는 대화 외에도 어느 한 채널이든 공지에든 여러 규정 사항들을 모아 놓으면 좋았을 것 같음
